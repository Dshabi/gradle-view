apply plugin: 'java'
apply plugin: 'idea'

group = 'com.github.rholder'
version = '1.0.0'

repositories {
    maven {
        url 'http://repo.gradle.org/gradle/libs-releases-local'
    }
    mavenCentral()
}

configurations {
    provided
}

sourceSets.main {
    compileClasspath += configurations.provided
}

jar {
    into('META-INF') {
        from 'META-INF/plugin.xml'
        from 'LICENSE'
    }
}

dependencies {
    compile "org.gradle:gradle-tooling-api:${gradleToolingApiVersion}"
    runtime 'org.slf4j:slf4j-simple:1.6.6'

    // IntelliJ plugin runtime libraries, since they're not available from a convenient repo
    provided files('intellij/extensions-ideaIC-122-SNAPSHOT.jar')
    provided files('intellij/openapi-ideaIC-122-SNAPSHOT.jar')
    provided files('intellij/util-ideaIC-122-SNAPSHOT.jar')
}

// ensure our project type is set to IntelliJ plugin
idea.module {
    jdkName = ideaPluginJdkName
    iml {
        withXml {
            def node = it.asNode()
            node.attributes().put('type','PLUGIN_MODULE')
        }
    }
}

task distPlugin(type: Zip, dependsOn: jar) {
    description = "Generate the IntelliJ plugin archive from the current project."
    into("${project.name}/lib") {
        from jar.archivePath
        from configurations.runtime
    }
}

// enable Gradle Wrapper support for bootstrapping with specific version
task wrapper(type: Wrapper) {
    gradleVersion = gradleToolingApiVersion
}
